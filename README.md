Demo code for P4 workshop
====

##Demo Target:

 - Self defined protocol
 - Stateful dataplane

##Topology:

```
H1 - P4S - H2
```

## Slide:

http://www.slideshare.net/YiTseng/2016-nctu-p4-workshop

## Requirements:

- [P4 BMV2](https://github.com/p4lang/behavioral-model)
- [P4 BMV2 configuration generator](https://github.com/p4lang/p4c-bm)
- [Scapy](http://www.secdev.org/projects/scapy/)

## Setup:

- Install requirements
- Setup your bmv2 and p4c-bmv path in env.sh
- Generate json configuration for P4 switch_path

```bash
$ ./compile_bmv2.sh
```

- Install scapy

```bash
$ sudo apt-get install python-scapy python-pyx python-gnuplot
```

## How to use:

- Start mininet topology

```bash
$ sudo ./topology.py
```

- Add table entries to switch

```bash
$ ./send_cmd.sh
```

- In mininet, start ./sender.py from h1 (in background)

```
mininet> h1 ./sender.py &
```

- In mininet start ./receiver.py from h2

```
mininet> h2 ./receiver.py
```

- The result shows on the screen, switch will let 5 packets pass, then drop next 5 packets repeat it until host 1 stop sending packet.

```
Received 11 bytes                                                                                                   
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x36 0x35
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello65
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x36 0x36
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello66
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x36 0x37
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello67
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x36 0x38
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello68
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x36 0x39
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello69
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x37 0x33
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello73
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x37 0x34
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello74
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x37 0x35
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello75
Received 11 bytes
Hex data: 0x0 0x0 0x0 0x1 0x48 0x65 0x6c 0x6c 0x6f 0x37 0x36
Src 0x0 0x0, Dst 0x0 0x1, Msg: Hello76
```
